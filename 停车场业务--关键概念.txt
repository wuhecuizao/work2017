1.在场车辆
    该功能提供了在系统中有在场记录的车辆信息查询，即车辆入场时记录信息和车辆在场内产生的信息。
6)【车辆进场说明】
对进场车辆进行补充备注，对不同状态下的车辆有区别的进行备注说明。
点击可以查看车辆详细进场说明：车辆正常进场时，进场说明显示“正常”；多位多车时VIP车辆转成临时车辆进场时，进场说明显示临时车进场时有哪些VIP车辆在场，包含了VIP车辆的车牌号和进场时间等字段；当VIP没有通道权限、访客进场或黑名单进场时，进场说明显示该VIP的通道权限和时间

2.出场记录
该模块提供了对已离场车辆进行完整进出场信息的查询功能。出场记录中记录的信息条目为所有匹配到在场记录并正常出场车辆的相关信息，对异常放行的离场车辆信息不予记录。

3.异常进场    异常进场功能提供了车辆在进场过程中产生异常的信息记录查询，通常只有一种情况会产生异常进场记录：当同辆车已有在场记录并再次进场时则会产生；或者说车辆进场时，系统检测到该车辆已有在场车辆记录，则把前一次的进场记录归为异常进场记录。
	
4.异常放行    异常放行功能提供了车辆在出场过程中产生异常的信息记录查询，通常在两种情况下会异常放行：第一种是出场时匹配在场记录后产生了费用，岗亭收费员可选择“异常放行”按钮，则该出场记录归为异常放行记录；第二种情况为出场时匹配不到该车辆的在场记录，则也将该记录归为异常放行记录。另外，同辆车在产生异常放行记录后该条出场信息不会在”出场记录“模块中产生。

5.非系统开闸
非系统开闸模块记录了特殊情况下需遥控强制开闸和可疑跟车开闸这两种记录。
一是当遥控器操作者按下开关临时抬杆放行时，系统会将车辆产生的信息记录归到遥控开闸。当车辆未触发地磁感应，收费员按下遥控开关抬杆放行的同时一体机做抓拍操作，产生车辆信息，则将此条信息作为遥控开闸记录；遥控开闸是在特殊情况下的低频操作，是当放行车辆时出现闸杆无反应情况所采取的临时应急措施。
当车辆放行过程以遥控开闸方式执行时，车辆不产生出场记录，只产生遥控开闸记录。
二是当A车触发地磁感应一体机抓拍并抬杆开闸，由于B车紧跟在A车后面，因B车与A车车距较短，闸机未完全落下，B车已触发地磁感应，闸机再次抬杆，这种情况下，系统将此条作为可疑跟车记录。可疑跟车记录依然会产生车辆出场记录。
.3应用场景
a. 当用户在中央交费处或APP端已缴费，出场时不抬杆开闸，显示仍有需缴费用
b. 未触发地感，一体机未做识别操作，闸杆无反应，
c. 紧急情况需立即抬杆放行。

6.收费流水
该功能模块记录所有产生收费流水的车辆相关信息。收费流水信息的产生来源为移动端、线上、线下等渠道。可供管理员随时查询车辆的收费相关信息。正常出场或者异常放行出场并产生收费流程的车辆就会有收费流水产生。

7.欠费车辆
该功能模块记录所有欠费车辆的相关信息，欠费车辆指的是在常开模式中，出场后有欠费尚未交清的车辆。
您可以在VEMS欠费车辆中查看欠费车辆信息，也可以在中央交费页面-欠费车辆中查看。
欠费车辆若被拉入自动欠费黑名单（自动欠费黑名单的次数限制，需要您在黑名单中进行设置），则在出入口进出场时，会在岗亭出入口系统及中央交费处提示该车状态，在岗亭出入口交费时，需要交清停车费及欠费。

8.异常拍照
异常拍照指所有车辆进场或出场时，一体机产生识别拍照动作但未做放行操作，此时再次触发拍照动作，则前一次拍照记录被记为一条异常拍照流水，包含车牌照片及车辆信息。该功能模块提供对这些异常记录的查询，辅助维护人员对系统问题的复现和定位。

9.校正流水
校正流水功能模块记录所有产生校正流水的车辆相关信息。校正流水信息的产生来源为中央监控、岗亭端、中央收费等渠道。可供管理员随时查询车辆的校正相关信息。发生了校正操作的车辆就会有校正流水产生。

其中VIP作为车辆身份信息的标示，有单独与其绑定的计费规则，且该计费规则在与其他计费规则并存时为最高优先级。

1.VIP类型
VIP指的是区别于一般进场车辆的特殊进场车辆，可通过VIP类型模块创建不同通行权限的VIP类型，并对其进行自定义配置；VIP类型只能与车主绑定，即VIP先是对应车主再是对应车主所有的车牌。

通行权限：通行权限指的是车辆在停车场中通行时的通行资格，进出有通行权限的出入口时，系统将车辆视为VIP车辆；车辆在进出无通行权限的出入口时，系统将车辆视为临时车。您可以根据实际情，自由配置通行权限。
开启多位多车：勾选“开启多位多车”后，可限制VIP车主的VIP车辆数，如可用车位数为2，车主绑定VIP车辆为3，则前2辆进场的车辆可视为VIP车辆，第三辆车则被视为临时车；若无勾选，系统将把VIP车主绑定的所有车牌对应车辆均视为VIP车辆。
多位多车满位，同组在场车辆无法进入：勾选“多位多车满位后，同组在场车辆无法进入”后，若同组已被识别为VIP身份的车辆未离场，则同组其余车辆进场身份为临时车，无法以VIP身份进场。在已被识别为VIP身份的车辆离场后，空出多余车位，其余识别为临时车的车辆，只能先出场后再进场才能被识别为VIP车辆。

2.车主信息
车主信息模块记录了所有新增的本地车主信息，可快速浏览查询已登记注册的车主相关信息。同时可对车主信息进行基本管理。

3.车辆管理
车辆管理功能模块分为六个子模块，依次为车辆信息、黑名单、访客车辆、预定车辆、红名单车辆、共享车位。车辆身份分组显示以便分类管理，各组对应进场车辆不同的识别身份，在车辆身份信息里，记录了所有新增的本地车主信息，可快速浏览查询已登记注册的车主相关信息。同时可对车主信息进行基本管理。
    3.1车辆信息
在该模块中的车辆信息都为新增的本地车主绑定的车牌对应车辆，包含未开通VIP的一般车辆和VIP车辆。通过【自定义条件搜索】可快速定位车辆信息
您可以【修改】、【删除】每个条目的车辆信息，同样可以【导出】搜索结果列表。修改、删除操作后的车辆信息将同步至车主信息模块中。



前提条件：一、vems正常运行且能正常连接一点停 二、vems对应的一体机正常上报 
1、进出场流程（模拟进场-查费-缴费-模拟离场）  
2、预存款流程（模拟进场-查费-预存款-模拟离场）
3、缴费记录查询（模拟进场-查费-缴费-缴费记录）
4、停车记录详情（模拟进场-查费-获取停车记录  或者 模拟进场-查费-缴费-离场-获取停车记录）
5、锁车流程（模拟进场-锁车-获取锁车状态-解锁-获取锁车状态）
6、VIP进出流程（创建VIP类型-开通月卡-模拟进场-模拟离场）
7、VIP退费流程（退费月卡-模拟进场-查费-缴费-模拟离场）
8、商家券使用流程（创建商家券-发送商家券-模拟进场-查费-缴费-模拟离场）
9、积分流程（获取用户积分-积分冲正-获取用户积分-积分扣减-获取用户积分）

注意；上述流程是测试环境下的流程。
预进场是摄像头抓拍触发的，表示一辆车到了道闸前，被道闸摄像机捕获到。
模拟进出场实际就是 告知线下停车场场道闸摄像头进行一次抓拍，只是我们在测试环境的vems做了自动放行的设置，这个模拟车就进场了。生产环境要根据实际停车场的业务需求来定制。
离场上报是车辆在道闸起竿后，车辆驶出闸口，由我方系统却判定其离场，产生的记录。或者，是操作员点击一体机管理界面的确认放行，也会产生离场记录。


粤通宝无感支付流程为：
1、一点停开放平台做车辆进场上报给粤通宝，粤通宝收到后要给一点停开放平台返回
{
    "data": {},
    "message": "业务成功",
    "resultCode": 0,
    "status": 1
}
否则，会重发该进场上报。
2、然后粤通宝根据自身业务获取车主的余额，使用一点停的下发车辆预存款接口（setPrestore）
下发车辆预存款。如果在车辆在场期间车主余额有变动，需要再次调用setPrestore，下发预存款。
3、车辆离场上报给粤通宝后，粤通宝收到后要给一点停开放平台返回
{
    "data": {},
    "message": "业务成功",
    "resultCode": 0,
    "status": 1
}

预进场未识别，可通过人工校正等操作进行处理，那么进场车牌就是校正后的车牌；离场时未识别，不开闸，可通过匹配在场记录的方式匹配车辆。

3 粤YMV993这辆车，出场时间是7月4号，为什么推送过来的日志实付金额是0元，但是在你们的系统上面显示是2元
这个问题是这样的：第三方系统调用一点停开放平台查费时，查到费用12元，缴费时，却缴了2元。vems会放行该车。
产生异常，只有totalAmount是12元，是对的。其他的值amountReceivable（应收金额）、discountAmount（优惠金额）和actualReceivable（车主实付金额）均是0元。
但vems端显示的是2元。此时需要查看reportParkingFee（临停缴费上报）的账单。
所以，第三方调用查费（getParkFee）和缴费（payParkFee）接口时，一定要查到多少钱就缴多少钱。

4、请问下粤EXV723 这个车牌在7/4号，"abnormalOutReason":"无记录暗示收费异常f放行",
"abnormalOutRemark":"无记录暗示收费异常f放行"，进场时间和出场时间都是一样的，
但是"actualReceivable":10.00，这是什么业务情况？是不是正常记录？
这个问题是这样的场景：车辆到达出口道闸，系统查不到该车的进场记录。于是收费员操作收费机点选异常放行，金额填写10元。

1 车牌：未识别0704152749462，入场parking_code=180704152749699327664462，出场parking_code=180704152749699272142573，两个code为什么不一致
2 车牌：未识别0704201913290，入场parking_code=180704201913699879567290，出场parking_code=180704201913699298903841，两个code为什么不一致
是这样的：进场未识别，就生成了parkingCode。出场又未识别的话。经过手动匹配，就会将进场的parkingCode赋给出场的。
如果不手动匹配，直接异常放行，就会模拟一条进场记录，上报，然后在上报出场。

退款流程：
退款走线下 不能随便退款的 我们都是要审核确认确实有问题才联系车主由甲方财务退款的
对账用excel核对  我们系统也有收费明细 核对后财务确认就可以 

无牌车扫码自助进出场:
无牌车进场：
无牌车进场，一体机提示请扫码，车主扫码（二维码带有接口的parkCode，channelSeq参数，该二维码是第三方的），然后系统后台调用“车辆扫通道二维码自助进出场”接口，一体机开闸进行进场
出场的时候传同样的userUniqCode，就会算出费用，然后调用缴费接口进行开闸
有一种场景是用户不是扫码，而是手输自助随机码就有用了

退费月卡接口，假如我8月续费了一个月的月卡，但是我在月中的时候取消了，剩下的半个月我还是算月卡用户吗？
不是了，临停车了


鲸:
1， 自动缴费开关为0-关闭时，还会发送离场上送过来吗？这个问题是这样的，如果下发预存款的话，自动缴费开关要为1，为0的话相当于调用接口没有意义。离场上报和这个开关没有关联。离场上报是车辆在道闸起竿后，车辆驶出闸口，由我方系统却判定其离场，产生的记录。或者，是操作员点击一体机管理界面的确认放行，也会产生离场记录。
2， 支付来源和支付方式这边要上送什么？这两个字段根据你的业务场景传递，支付来源一般要表示清楚 调用接口方，支付方式要标识清楚 调用方的实际支付方式。

鲸:
主要是用于调用方自己看的。比如你在微信小程序李进行微信支付，那么我们建议： 支付来源=14，支付来源备注=粤通宝，支付方式=4，支付方式备注=与你的业务逻辑相关的标识

1、对账如何做？
答：使用计费类接口--缴费记录查询接口进行对账，paymentRecordQuery 
可以查询到一天的账单信息。http://openydt.yidianting.xin/#/Api/paymentRecordQuery

3、
enterCarLicenseType
是
Integer
进场车牌类型（0未定义，1蓝牌白字，2黄牌黑字，3黑牌白字，4白牌）

enterCarLicenseColor
是
Integer
进场车牌颜色（0未定义，1蓝色，2黄色，3白色，4黑色，5绿色）
有关联吗？
答：有关联，使用enterCarLicenseColor即可。但颜色不能保证百分之百准确

2、enterCarType
是
Integer
车辆类型（0未知，1小车，2大车，3超大车，4中型车）
答：根据车牌颜色来判定的，一般黄色的为大车（学字牌认定为小车）

临停缴费上报：一般来说shouldCharge=platformShouldPay+actPayCharge+couponValues,注意一般platformShouldPay和actPayCharge只能有一个不为0.
同时，也有可能shouldCharge!=platformShouldPay+actPayCharge+couponValues

鲸:
临停缴费时，会上报账单号，拿着这个账单号可以去对账
鲸:
如果需要对账文件，需要在艾科的pomp进行操作
鲸:
这个系统需要你们开通相关权限

1、我们场内手机支付一般分快捷支付和登陆支付
2、快捷支付就是指车主不需要其他任何的操作，只要扫码就可以输入车牌，然后交费，这种情况下，只支持商家劵优惠，因为商家劵领取时是指定车牌的
3、登陆界面的话是会员经过登陆之后的交费，确认了会员身份才可以使用DNA商场的积分，这样可以保证只有会员车主本人可以使用自己的积分


缴费返回“远程服务器未响应”，两种情况：1、网络问题，与一点停断开 2、vems处理慢，超时
通讯端在线，但是vems数据上报不上来的原因：1、vems的parkCode配置错误；2、aomp通信端的parkCode配置错误

h5快捷支付接口：对应着一个二维码连接，如果授权商仅一个车场，那么使用停车场上线信息中游客缴费的连接，如果多个车厂使用顶级运营商中的一点停快捷支付
一般推荐使用无缝接入一点停

就是储值类型和次数类型的月卡续费的时候，明显和时间没关系，这个时候month、timePeriodList这两个参数要怎么填？
用month这个字段，值填1的话，相当于这个储值在1个月内有效。如果希望一直有效，把时间拉的长一些。代表在原有效期上加1个月

一点停支付后，已经采用微信禁默授权，获取到用户的openid，



怡鑫:
现在我的问题是这样的：无牌车进场我这边的系统会记录一条信息，在没有对应的出场记录前，是不允许再次无牌车进场的。
怡鑫:
但刚刚我查了一下，这几天的无牌车有一些，进场是扫码进来的，出场的时候是人工手动匹配然后出去的
怡鑫:
这样一来，我这边的无牌车进场记录，就没办法查询到这车是否已经出场。
鲸:
“无牌车进场我这边的系统会记录一条信息，在没有对应的出场记录前，是不允许再次无牌车进场的。”的逻辑要改一下。如果车主在出场处不扫码，vems也不知道是他出场了。
怡鑫:
人工匹配的啊
鲸:
怎么人工匹配？直接匹配的进场记录是吧。但实际没有和前面进场的随机码关联。所以不知道
怡鑫:
目前，我想到的有两个方法，你看下能否做到（最好是第一个）：
1、进场的时候，把“车牌号carCode”或者“停车唯一编码parkingCode”返回给我，有一个就够了；
2、接口提供我通过“进场随机码”或者“用户编号”去查记录的功能。
鲸:
目前都做不到，你需要对“无牌车进场我这边的系统会记录一条信息，在没有对应的出场记录前，是不允许再次无牌车进场的。”的逻辑做更改
怡鑫:
车牌号，可以是“未识别xxxxx”这样的，在你们的离场上报信息里可以匹配到
怡鑫:
再不行，还有一个办法，离场上报记录里，把进场随机码和用户编号给出来？
鲸:
也不行，因为离场是用户不是扫码的，系统根本不知道匹配哪个扫码的进场记录。人工匹配和自助扫码是两套逻辑，不存在关联性


同一辆车多次缴费，线下线上均会产生多条账单，和为停车总费用。
查费返回的otherAttr的chargeBillNumber是唯一标识此次查费的序列号。缴费时带上，vems就用这个去区域账单匹配；不带，就在缓存里查找，缓存保存时间最大30分钟，最小7分钟。

固定ip费用分为带宽费用和固定ip租用费用

确定下流程调用选的接口对不对，还是智泊云当前没有支持这个接口，有没有替代接口可以实现

一位多车，已有车辆进场，另一辆进场后，如何获取后一辆车的身份及停车费用信息：
答：调用getParkDetail接口获取进场VIP信息，然后查费
注意：getParkFee中的字段carChargeType可能并不准确，不能采用

注意：vip类型是和通道绑定的

关于电子券叠加及下发车牌券后，查费返回的otherAttr的traderCouponList指的判定：
1、属性相同的优惠券（完全相同，金额也相同）可以叠加，最多叠加3张
2、不同类型属性的商家券不能叠加；如类型相同，金额不一样的优惠券也是不可以叠加
3、通过开放平台接口，目前实现不了叠加（mgr-weixin支持才可以）；另外，vems需要2.16优化版才支持
4、其他类型优惠，如通用券，停车场线上优惠，第三方优惠等不支持
5、只支持时间券、金额扣减券两种类型，其他不支持

优惠券 只支持 同样的券进行叠加，名称不同的不能叠加，如优惠2小时跟优惠3小时不能叠加的

商家券的使用规则:假如没有指定商家券,有多张商家券n,停车场端会先不用券查出费用a,
再分别带商家券查出n次费用bn,那么每次算出的优惠金额fn = bn -a, 
那么优惠金额最大的那个券就作为本次查费的用券对象,如果优惠金额为0,那么本次查费就不会指定使用券

访客车辆是vems的预订，预订车辆是一点停的预订，共享车位是第三方平台的预订

访客一般用于是临车严禁的场景（线上也可用），同时存在是否一次进入即失效的场景。
预订是线上对线下做的未来的时间段的vip月票，只针对线上下发线下的场景。
共享是车主有空闲时间段不在场内，可提供给其他车主使用的场景。约定：时间段确定后，先于时间开始时间之前进场的费用需要给到车场，晚于结束时间出场，多余费用给到车主。
对于车位提供方在场，有提供共享时段的车，需要共享系统来判定，一点停和vems不做判定。


车位上报：10秒之内，有辆车进来就会触发


单个车场带车牌代缴
https://devnew.yidianting.xin/p3424?carNo=57KkU0QxMTEx&vue=checkFee

所有车场带车牌代缴
https://devnew.yidianting.xin/weixin/html/visit/quickpay.do?pay=allpark&carNo=57KkU0QxMTEx&vue=checkFee


认证的特权包括：
1、缴费时，显示车场相关信息更精确
2、认证后，车辆进场出场等消息推送会更准确。否则会提醒用户认证
3、认证了后，可以选择隐私保护。他人查询该车牌会显示不可查询

无牌车扫码自助进出场:（vems2.16（含）以上）
无牌车进场：
无牌车进场，调用“车辆扫通道二维码自助进出场”接口，一体机开闸进行进场（返回参数parkingCode还是null）。
出场的时候传同样的userUniqCode，调用scanChannelCodeInOut ，返回参数parkingCode不为空，然后调用查费、缴费接口。一体机判断是否开闸出场。